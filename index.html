<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Candle Workshop - Multi-Language</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Quicksand:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #FF6B9D;
            --secondary: #FEC260;
            --accent: #4ECDC4;
            --dark: #2D3561;
            --light: #FFF9F0;
            --gradient-1: linear-gradient(135deg, #FF6B9D 0%, #C44569 100%);
            --gradient-2: linear-gradient(135deg, #FEC260 0%, #F77062 100%);
            --gradient-3: linear-gradient(135deg, #4ECDC4 0%, #44A08D 100%);
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        @keyframes floatIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 20px rgba(255, 107, 157, 0.4); }
            50% { box-shadow: 0 0 40px rgba(255, 107, 157, 0.8); }
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        body {
            font-family: 'Quicksand', sans-serif;
            background: linear-gradient(135deg, #FFF9F0 0%, #FFE6F0 50%, #E6F7F5 100%);
            background-attachment: fixed;
            color: var(--dark);
            min-height: 100vh;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: 
                radial-gradient(circle at 20% 50%, rgba(255, 107, 157, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(78, 205, 196, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        .header {
            background: var(--gradient-1);
            color: white;
            padding: 2rem;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
            animation: floatIn 0.6s ease;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .header h1 {
            font-family: 'Playfair Display', serif;
            font-size: 2.5rem;
            animation: bounce 2s ease-in-out infinite;
        }

        .lang-selector {
            display: flex;
            gap: 0.5rem;
            background: rgba(255, 255, 255, 0.2);
            padding: 0.5rem;
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }

        .lang-btn {
            background: rgba(255, 255, 255, 0.3);
            border: none;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .lang-btn:hover {
            background: rgba(255, 255, 255, 0.5);
            transform: translateY(-2px);
        }

        .lang-btn.active {
            background: white;
            color: var(--primary);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
            position: relative;
            z-index: 1;
        }

        .tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            animation: slideIn 0.6s;
        }

        .tab-btn {
            background: white;
            border: none;
            color: var(--dark);
            padding: 1rem 2rem;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            border-radius: 16px;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        }

        .tab-btn:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.15);
        }

        .tab-btn.active {
            background: var(--gradient-1);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: floatIn 0.5s;
        }

        .card {
            background: white;
            border-radius: 24px;
            padding: 2rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow);
            transition: all 0.4s;
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 4px;
            background: var(--gradient-2);
        }

        .card:hover {
            transform: translateY(-4px);
        }

        .card h2 {
            font-family: 'Playfair Display', serif;
            font-size: 2rem;
            background: var(--gradient-1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 1.5rem;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
        }

        .input-group {
            margin-bottom: 1.2rem;
            animation: slideIn 0.3s;
        }

        .input-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .input-group input, .input-group select, .input-group textarea {
            width: 100%;
            padding: 0.9rem;
            border: 2px solid #E0E7FF;
            border-radius: 12px;
            font-family: 'Quicksand', sans-serif;
            transition: all 0.3s;
        }

        .input-group input:focus, .input-group select:focus, .input-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(255, 107, 157, 0.1);
            transform: translateY(-2px);
        }

        .btn {
            background: var(--gradient-1);
            color: white;
            border: none;
            padding: 1rem 2.5rem;
            border-radius: 16px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 4px 20px rgba(255, 107, 157, 0.3);
        }

        .btn:hover {
            transform: translateY(-4px) scale(1.05);
            box-shadow: 0 8px 30px rgba(255, 107, 157, 0.4);
        }

        .btn-secondary {
            background: var(--gradient-2);
        }

        .btn-success {
            background: var(--gradient-3);
        }

        .btn-danger {
            background: linear-gradient(135deg, #FF6B9D 0%, #FF5370 100%);
        }

        .btn-small {
            padding: 0.6rem 1.2rem;
            font-size: 0.85rem;
        }

        .item {
            background: linear-gradient(135deg, #FFFFFF 0%, #FFF9F0 100%);
            padding: 1.5rem;
            margin-bottom: 1rem;
            border-radius: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 4px solid var(--accent);
            transition: all 0.3s;
            animation: slideIn 0.4s;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }

        .item:hover {
            transform: translateX(8px);
        }

        .item.low-stock {
            border-left-color: var(--secondary);
            animation: pulse 2s infinite;
        }

        .item.out-of-stock {
            border-left-color: #FF5370;
            animation: glow 2s infinite;
        }

        .item-info h3 {
            font-family: 'Playfair Display', serif;
            font-size: 1.3rem;
        }

        .item-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .alert {
            padding: 1.2rem;
            border-radius: 16px;
            margin-bottom: 1rem;
            animation: slideIn 0.4s;
        }

        .alert-warning {
            background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%);
            border-left: 4px solid var(--secondary);
        }

        .alert-danger {
            background: linear-gradient(135deg, #FEE2E2 0%, #FECACA 100%);
            border-left: 4px solid #FF5370;
        }

        .alert-success {
            background: linear-gradient(135deg, #D1FAE5 0%, #A7F3D0 100%);
            border-left: 4px solid var(--accent);
        }

        .recipe-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .recipe-preview {
            background: white;
            border-radius: 20px;
            padding: 1.8rem;
            box-shadow: var(--shadow);
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            animation: floatIn 0.5s;
        }

        .recipe-preview:hover {
            transform: translateY(-8px) rotate(2deg);
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.15);
        }

        .recipe-preview h3 {
            font-family: 'Playfair Display', serif;
            font-size: 1.5rem;
            margin-bottom: 0.8rem;
        }

        .cost-badge {
            background: var(--gradient-1);
            color: white;
            padding: 0.6rem 1.2rem;
            border-radius: 20px;
            font-weight: 600;
            display: inline-block;
            margin: 1rem 0;
            animation: pulse 2s infinite;
        }

        .missing-badge {
            background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%);
            color: #92400E;
            padding: 0.8rem 1rem;
            border-radius: 12px;
            margin: 1rem 0;
            font-size: 0.9rem;
            border-left: 3px solid var(--secondary);
        }

        .missing-badge ul {
            margin: 0.5rem 0 0 0;
            padding-left: 1.5rem;
        }

        .missing-badge li {
            margin: 0.3rem 0;
        }

        .ingredients-needed {
            background: linear-gradient(135deg, #E6F7F5 0%, #D1FAE5 100%);
            padding: 1rem;
            border-radius: 12px;
            margin: 1rem 0;
            border-left: 3px solid var(--accent);
        }

        .ingredients-needed h4 {
            color: var(--dark);
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }

        .ingredients-needed ul {
            list-style: none;
            padding: 0;
        }

        .ingredients-needed li {
            padding: 0.3rem 0;
            padding-left: 1.5rem;
            position: relative;
        }

        .ingredients-needed li:before {
            content: "‚úì";
            position: absolute;
            left: 0;
            color: var(--accent);
            font-weight: bold;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(45, 53, 97, 0.8);
            backdrop-filter: blur(10px);
            z-index: 1000;
            overflow-y: auto;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .modal-content {
            background: white;
            border-radius: 24px;
            max-width: 900px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            animation: floatIn 0.4s;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            background: var(--gradient-1);
            color: white;
            padding: 2.5rem;
            border-radius: 24px 24px 0 0;
            position: sticky;
            top: 0;
        }

        .modal-header h2 {
            font-family: 'Playfair Display', serif;
            font-size: 2.2rem;
            color: white !important;
            -webkit-text-fill-color: white !important;
        }

        .close-modal {
            position: absolute;
            top: 1.5rem; right: 1.5rem;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 2rem;
            width: 45px; height: 45px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s;
        }

        .close-modal:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg) scale(1.1);
        }

        .modal-body {
            padding: 2rem;
        }

        .quantity-selector {
            display: flex;
            align-items: center;
            gap: 1rem;
            background: linear-gradient(135deg, #FFF9F0 0%, #FFE6F0 100%);
            padding: 1.2rem;
            border-radius: 16px;
            margin-bottom: 1.5rem;
        }

        .quantity-selector input {
            width: 80px;
            text-align: center;
            font-size: 1.3rem;
            font-weight: 700;
        }

        .ingredient-item {
            background: linear-gradient(135deg, #FFF9F0 0%, #FFE6F0 100%);
            padding: 1.2rem;
            border-radius: 12px;
            margin-bottom: 0.8rem;
            display: flex;
            justify-content: space-between;
            transition: all 0.3s;
        }

        .ingredient-item:hover {
            transform: translateX(5px);
        }

        .instructions-list {
            list-style: none;
            counter-reset: step;
        }

        .instructions-list li {
            counter-increment: step;
            padding: 1.2rem;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, #FFFFFF 0%, #FFF9F0 100%);
            border-radius: 12px;
            padding-left: 4.5rem;
            position: relative;
            transition: all 0.3s;
        }

        .instructions-list li:hover {
            transform: translateX(5px);
        }

        .instructions-list li:before {
            content: counter(step);
            position: absolute;
            left: 1.2rem; top: 50%;
            transform: translateY(-50%);
            background: var(--gradient-2);
            color: white;
            width: 2.5rem; height: 2.5rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
        }

        .cost-summary {
            background: var(--gradient-1);
            color: white;
            padding: 2rem;
            border-radius: 20px;
            margin-top: 2rem;
        }

        .cost-row {
            display: flex;
            justify-content: space-between;
            padding: 0.8rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .cost-row.total {
            font-size: 1.4rem;
            font-weight: 700;
            border-top: 2px solid rgba(255, 255, 255, 0.4);
            border-bottom: none;
            margin-top: 1rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            padding: 2rem;
            border-radius: 20px;
            text-align: center;
            box-shadow: var(--shadow);
            transition: all 0.4s;
            border-top: 4px solid;
            animation: floatIn 0.5s;
        }

        .stat-card:nth-child(1) { border-color: #FF6B9D; }
        .stat-card:nth-child(2) { border-color: #FEC260; }
        .stat-card:nth-child(3) { border-color: #4ECDC4; }
        .stat-card:nth-child(4) { border-color: #667EEA; }

        .stat-card:hover {
            transform: translateY(-8px) scale(1.05);
        }

        .stat-card h3 {
            font-family: 'Playfair Display', serif;
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        @media (max-width: 768px) {
            .header h1 { font-size: 2rem; }
            .grid, .recipe-grid { grid-template-columns: 1fr; }
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div>
                <h1>üïØÔ∏è <span id="appTitle">Candle Workshop</span></h1>
                <p id="appSubtitle">Professional candle production management tool</p>
            </div>
            <div class="lang-selector">
                <button class="lang-btn" onclick="setLang('ro')">üá∑üá¥</button>
                <button class="lang-btn" onclick="setLang('en')">üá¨üáß</button>
                <button class="lang-btn" onclick="setLang('es')">üá™üá∏</button>
                <button class="lang-btn" onclick="setLang('fr')">üá´üá∑</button>
                <button class="lang-btn" onclick="setLang('de')">üá©üá™</button>
                <button class="lang-btn" onclick="setLang('it')">üáÆüáπ</button>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="tabs">
            <button class="tab-btn active" onclick="showTab(0)" id="tab0">Dashboard</button>
            <button class="tab-btn" onclick="showTab(1)" id="tab1">Inventory</button>
            <button class="tab-btn" onclick="showTab(2)" id="tab2">Recipes</button>
            <button class="tab-btn" onclick="showTab(3)" id="tab3">Production History</button>
            <button class="tab-btn" onclick="showTab(4)" id="tab4">Calendar</button>
        </div>

        <!-- Dashboard -->
        <div class="tab-content active">
            <div class="stats-grid">
                <div class="stat-card">
                    <h3 id="stat1">0</h3>
                    <p id="statLabel1">Materials in Stock</p>
                </div>
                <div class="stat-card">
                    <h3 id="stat2">0</h3>
                    <p id="statLabel2">Low Stock Alerts</p>
                </div>
                <div class="stat-card">
                    <h3 id="stat3">0</h3>
                    <p id="statLabel3">Candles Produced</p>
                </div>
                <div class="stat-card">
                    <h3 id="stat4">0</h3>
                    <p id="statLabel4">Events Scheduled</p>
                </div>
            </div>
            <div class="card">
                <h2 id="alertsTitle">Stock Alerts</h2>
                <div id="alerts"></div>
            </div>
        </div>

        <!-- Inventory -->
        <div class="tab-content">
            <div class="card">
                <h2 id="invTitle">Add Material to Inventory</h2>
                <div class="grid">
                    <div class="input-group">
                        <label id="nameLabel">Material Name</label>
                        <input type="text" id="matName">
                    </div>
                    <div class="input-group">
                        <label id="qtyLabel">Quantity</label>
                        <input type="number" id="matQty">
                    </div>
                    <div class="input-group">
                        <label id="unitLabel">Unit</label>
                        <select id="matUnit">
                            <option value="g">g</option>
                            <option value="kg">kg</option>
                            <option value="ml">ml</option>
                            <option value="l">l</option>
                            <option value="pcs">pcs</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label><span id="priceLabel">Price per Unit</span> (<span id="curr">USD</span>)</label>
                        <input type="number" step="0.01" id="matPrice">
                    </div>
                    <div class="input-group">
                        <label id="minLabel">Min Stock Alert</label>
                        <input type="number" id="matMin">
                    </div>
                </div>
                <button class="btn" onclick="addMat()" id="addBtn">Add Material</button>
            </div>
            <div class="card">
                <h2 id="invListTitle">Materials Inventory</h2>
                <div id="matList"></div>
            </div>
        </div>

        <!-- Recipes -->
        <div class="tab-content">
            <div class="card">
                <h2 id="recTitle">Pre-installed Recipes</h2>
                <div class="recipe-grid" id="recList"></div>
            </div>
        </div>

        <!-- Production History -->
        <div class="tab-content">
            <div class="card">
                <h2 id="histTitle">Production History</h2>
                <div id="histList"></div>
            </div>
        </div>

        <!-- Calendar -->
        <div class="tab-content">
            <div class="card">
                <h2 id="calTitle">Add Event</h2>
                <div class="grid">
                    <div class="input-group">
                        <label id="typeLabel">Type</label>
                        <select id="evType">
                            <option value="prod" id="optProd">Production</option>
                            <option value="sale" id="optSale">Sale</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label id="titleLabel">Title</label>
                        <input type="text" id="evTitle">
                    </div>
                    <div class="input-group">
                        <label id="dateLabel">Date</label>
                        <input type="date" id="evDate">
                    </div>
                    <div class="input-group">
                        <label id="timeLabel">Time</label>
                        <input type="time" id="evTime">
                    </div>
                </div>
                <button class="btn" onclick="addEv()" id="addEvBtn">Add Event</button>
                <button class="btn btn-secondary" onclick="exportCal()" id="exportBtn">Export Calendar</button>
            </div>
            <div class="card">
                <h2 id="evListTitle">Scheduled Events</h2>
                <div id="evList"></div>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <button class="close-modal" onclick="closeMod()">&times;</button>
                <h2 id="modName"></h2>
                <p id="modDesc"></p>
            </div>
            <div class="modal-body">
                <div class="quantity-selector">
                    <label id="qtyModLabel">Quantity:</label>
                    <button class="btn btn-secondary btn-small" onclick="chgQty(-1)">-</button>
                    <input type="number" id="prodQty" value="1" min="1" readonly>
                    <button class="btn btn-secondary btn-small" onclick="chgQty(1)">+</button>
                    <span id="pcsLabel">pcs</span>
                </div>
                <div style="margin-bottom:2rem">
                    <h3 style="font-family:'Playfair Display';color:var(--dark);margin-bottom:1rem">Ingredients</h3>
                    <div id="modIng"></div>
                </div>
                <div style="margin-bottom:2rem">
                    <h3 style="font-family:'Playfair Display';color:var(--dark);margin-bottom:1rem">Instructions</h3>
                    <ol class="instructions-list" id="modInstr"></ol>
                </div>
                <div class="cost-summary">
                    <h3 style="color:white;margin-bottom:1.5rem">Cost Calculation</h3>
                    <div id="modCost"></div>
                </div>
                <div style="display:flex;gap:1rem;margin-top:2rem;flex-wrap:wrap">
                    <button class="btn btn-success" onclick="produce()" style="flex:1" id="prodBtn">Start Production</button>
                    <button class="btn btn-secondary" onclick="closeMod()" id="closeBtn">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script>
const T = {
    ro: { appTitle: "Atelier Lum√¢nƒÉri", appSubtitle: "Instrument profesional pentru produc»õia de lum√¢nƒÉri", tab0: "Dashboard", tab1: "Inventar", tab2: "Re»õete", tab3: "Istoric", tab4: "Calendar", statLabel1: "Materiale √Æn Stoc", statLabel2: "Alerte Stoc ScƒÉzut", statLabel3: "Lum√¢nƒÉri Produse", statLabel4: "Evenimente", alertsTitle: "Alerte Stoc", invTitle: "AdaugƒÉ Material", nameLabel: "Nume Material", qtyLabel: "Cantitate", unitLabel: "Unitate", priceLabel: "Pre»õ per Unitate", minLabel: "Stoc Minim", addBtn: "AdaugƒÉ Material", invListTitle: "Inventar Materiale", recTitle: "Re»õete Pre-instalate", histTitle: "Istoric Produc»õie", calTitle: "AdaugƒÉ Eveniment", typeLabel: "Tip", optProd: "Produc»õie", optSale: "V√¢nzare", titleLabel: "Titlu", dateLabel: "Data", timeLabel: "Ora", addEvBtn: "AdaugƒÉ Eveniment", exportBtn: "Export Calendar", evListTitle: "Evenimente", qtyModLabel: "Cantitate:", pcsLabel: "buc", prodBtn: "üè≠ √éncepe Produc»õia", closeBtn: "√énchide", curr: "RON", missingItems: "Materiale lipsƒÉ", needsTitle: "Ingrediente necesare" },
    en: { appTitle: "Candle Workshop", appSubtitle: "Professional candle production management tool", tab0: "Dashboard", tab1: "Inventory", tab2: "Recipes", tab3: "History", tab4: "Calendar", statLabel1: "Materials in Stock", statLabel2: "Low Stock Alerts", statLabel3: "Candles Produced", statLabel4: "Events", alertsTitle: "Stock Alerts", invTitle: "Add Material to Inventory", nameLabel: "Material Name", qtyLabel: "Quantity", unitLabel: "Unit", priceLabel: "Price per Unit", minLabel: "Min Stock", addBtn: "Add Material", invListTitle: "Materials Inventory", recTitle: "Pre-installed Recipes", histTitle: "Production History", calTitle: "Add Event", typeLabel: "Type", optProd: "Production", optSale: "Sale", titleLabel: "Title", dateLabel: "Date", timeLabel: "Time", addEvBtn: "Add Event", exportBtn: "Export Calendar", evListTitle: "Events", qtyModLabel: "Quantity:", pcsLabel: "pcs", prodBtn: "üè≠ Start Production", closeBtn: "Close", curr: "USD", missingItems: "Missing items", needsTitle: "Ingredients needed" },
    es: { appTitle: "Taller de Velas", appSubtitle: "Herramienta profesional para gesti√≥n de velas", tab0: "Panel", tab1: "Inventario", tab2: "Recetas", tab3: "Historial", tab4: "Calendario", statLabel1: "Materiales en Stock", statLabel2: "Alertas Stock Bajo", statLabel3: "Velas Producidas", statLabel4: "Eventos", alertsTitle: "Alertas de Stock", invTitle: "Agregar Material", nameLabel: "Nombre Material", qtyLabel: "Cantidad", unitLabel: "Unidad", priceLabel: "Precio por Unidad", minLabel: "Stock M√≠nimo", addBtn: "Agregar Material", invListTitle: "Inventario", recTitle: "Recetas", histTitle: "Historial", calTitle: "Agregar Evento", typeLabel: "Tipo", optProd: "Producci√≥n", optSale: "Venta", titleLabel: "T√≠tulo", dateLabel: "Fecha", timeLabel: "Hora", addEvBtn: "Agregar Evento", exportBtn: "Exportar", evListTitle: "Eventos", qtyModLabel: "Cantidad:", pcsLabel: "pzs", prodBtn: "üè≠ Iniciar", closeBtn: "Cerrar", curr: "EUR", missingItems: "Faltan art√≠culos", needsTitle: "Ingredientes necesarios" },
    fr: { appTitle: "Atelier Bougies", appSubtitle: "Outil professionnel pour la production de bougies", tab0: "Tableau", tab1: "Inventaire", tab2: "Recettes", tab3: "Historique", tab4: "Calendrier", statLabel1: "Mat√©riaux", statLabel2: "Alertes Stock", statLabel3: "Bougies Produites", statLabel4: "√âv√©nements", alertsTitle: "Alertes", invTitle: "Ajouter Mat√©riau", nameLabel: "Nom", qtyLabel: "Quantit√©", unitLabel: "Unit√©", priceLabel: "Prix", minLabel: "Stock Min", addBtn: "Ajouter", invListTitle: "Inventaire", recTitle: "Recettes", histTitle: "Historique", calTitle: "Ajouter √âv√©nement", typeLabel: "Type", optProd: "Production", optSale: "Vente", titleLabel: "Titre", dateLabel: "Date", timeLabel: "Heure", addEvBtn: "Ajouter", exportBtn: "Exporter", evListTitle: "√âv√©nements", qtyModLabel: "Quantit√©:", pcsLabel: "pcs", prodBtn: "üè≠ D√©marrer", closeBtn: "Fermer", curr: "EUR", missingItems: "Articles manquants", needsTitle: "Ingr√©dients n√©cessaires" },
    de: { appTitle: "Kerzenwerkstatt", appSubtitle: "Professionelles Kerzenproduktions-Tool", tab0: "Dashboard", tab1: "Inventar", tab2: "Rezepte", tab3: "Verlauf", tab4: "Kalender", statLabel1: "Materialien", statLabel2: "Warnungen", statLabel3: "Kerzen", statLabel4: "Ereignisse", alertsTitle: "Warnungen", invTitle: "Material hinzuf√ºgen", nameLabel: "Name", qtyLabel: "Menge", unitLabel: "Einheit", priceLabel: "Preis", minLabel: "Min", addBtn: "Hinzuf√ºgen", invListTitle: "Inventar", recTitle: "Rezepte", histTitle: "Verlauf", calTitle: "Ereignis", typeLabel: "Typ", optProd: "Produktion", optSale: "Verkauf", titleLabel: "Titel", dateLabel: "Datum", timeLabel: "Zeit", addEvBtn: "Hinzuf√ºgen", exportBtn: "Exportieren", evListTitle: "Ereignisse", qtyModLabel: "Menge:", pcsLabel: "Stk", prodBtn: "üè≠ Starten", closeBtn: "Schlie√üen", curr: "EUR", missingItems: "Fehlende Artikel", needsTitle: "Ben√∂tigte Zutaten" },
    it: { appTitle: "Laboratorio Candele", appSubtitle: "Strumento professionale per candele", tab0: "Dashboard", tab1: "Inventario", tab2: "Ricette", tab3: "Storico", tab4: "Calendario", statLabel1: "Materiali", statLabel2: "Avvisi", statLabel3: "Candele", statLabel4: "Eventi", alertsTitle: "Avvisi", invTitle: "Aggiungi Materiale", nameLabel: "Nome", qtyLabel: "Quantit√†", unitLabel: "Unit√†", priceLabel: "Prezzo", minLabel: "Min", addBtn: "Aggiungi", invListTitle: "Inventario", recTitle: "Ricette", histTitle: "Storico", calTitle: "Aggiungi Evento", typeLabel: "Tipo", optProd: "Produzione", optSale: "Vendita", titleLabel: "Titolo", dateLabel: "Data", timeLabel: "Ora", addEvBtn: "Aggiungi", exportBtn: "Esporta", evListTitle: "Eventi", qtyModLabel: "Quantit√†:", pcsLabel: "pz", prodBtn: "üè≠ Avvia", closeBtn: "Chiudi", curr: "EUR", missingItems: "Articoli mancanti", needsTitle: "Ingredienti necessari" }
};

const CR = { RON: 4.97, USD: 1.09, EUR: 1.0, GBP: 0.86 };
let L = localStorage.getItem('lang') || 'en';
let INV = JSON.parse(localStorage.getItem('inv')) || [];
let HIST = JSON.parse(localStorage.getItem('hist')) || [];
let EVS = JSON.parse(localStorage.getItem('evs')) || [];
let CUR_REC = null;

const RECS = [
    { 
        name: { en: "Relaxing Lavender Candle", ro: "Lum√¢nare LavandƒÉ RelaxantƒÉ", es: "Vela Relajante de Lavanda", fr: "Bougie Lavande Relaxante", de: "Entspannende Lavendelkerze", it: "Candela Lavanda Rilassante" }, 
        ing: [
            { n: { en: "Soy wax", ro: "CearƒÉ de soia", es: "Cera de soja", fr: "Cire de soja", de: "Sojawachs", it: "Cera di soia" }, q: 200, u: "g" }, 
            { n: { en: "Lavender essential oil", ro: "Ulei esen»õial de lavandƒÉ", es: "Aceite esencial de lavanda", fr: "Huile essentielle de lavande", de: "Lavendel √§therisches √ñl", it: "Olio essenziale di lavanda" }, q: 10, u: "ml" }, 
            { n: { en: "Cotton wick", ro: "Fitil de bumbac", es: "Mecha de algod√≥n", fr: "M√®che en coton", de: "Baumwolldocht", it: "Stoppino di cotone" }, q: 1, u: "pcs" },
            { n: { en: "Glass container", ro: "Recipient sticlƒÉ", es: "Recipiente de vidrio", fr: "R√©cipient en verre", de: "Glasbeh√§lter", it: "Contenitore di vetro" }, q: 1, u: "pcs" },
            { n: { en: "Purple dye", ro: "Colorant mov", es: "Colorante morado", fr: "Colorant violet", de: "Lila Farbstoff", it: "Colorante viola" }, q: 2, u: "ml" }
        ], 
        instr: [
            { en: "Prepare the container: Clean and dry the glass jar. Fix the wick in center.", ro: "PregƒÉte»ôte recipientul: CurƒÉ»õƒÉ »ôi usucƒÉ vasul. FixeazƒÉ fitilul √Æn centru.", es: "Prepara el recipiente: Limpia y seca el frasco. Fija la mecha al centro.", fr: "Pr√©parez le r√©cipient: Nettoyez et s√©chez le pot. Fixez la m√®che au centre.", de: "Bereiten Sie den Beh√§lter vor: Reinigen und trocknen Sie das Glas. Befestigen Sie den Docht in der Mitte.", it: "Prepara il contenitore: Pulisci e asciuga il vaso. Fissa lo stoppino al centro." }, 
            { en: "Melt wax: Heat soy wax to 70-75¬∞C using double boiler or microwave.", ro: "Tope»ôte ceara: √éncƒÉlze»ôte ceara de soia la 70-75¬∞C la bain-marie sau microunde.", es: "Derrite la cera: Calienta la cera de soja a 70-75¬∞C al ba√±o mar√≠a o microondas.", fr: "Faire fondre la cire: Chauffez la cire de soja √† 70-75¬∞C au bain-marie.", de: "Wachs schmelzen: Erhitzen Sie Sojawachs auf 70-75¬∞C im Wasserbad.", it: "Sciogli la cera: Riscalda la cera di soia a 70-75¬∞C a bagnomaria." }, 
            { en: "Add dye: When wax is melted, add purple dye and mix until uniform color.", ro: "AdaugƒÉ colorant: C√¢nd ceara e topitƒÉ, adaugƒÉ colorantul mov »ôi amestecƒÉ uniform.", es: "A√±ade colorante: Cuando la cera est√© derretida, a√±ade colorante morado y mezcla.", fr: "Ajoutez colorant: Lorsque la cire est fondue, ajoutez le colorant violet.", de: "Farbstoff hinzuf√ºgen: Wenn das Wachs geschmolzen ist, lila Farbstoff hinzuf√ºgen.", it: "Aggiungi colorante: Quando la cera √® sciolta, aggiungi colorante viola." },
            { en: "Add fragrance: Let wax cool to 60¬∞C, then add lavender essential oil. Mix for 2 minutes.", ro: "AdaugƒÉ parfum: LasƒÉ ceara sƒÉ se rƒÉceascƒÉ la 60¬∞C, apoi adaugƒÉ uleiul de lavandƒÉ. AmestecƒÉ 2 minute.", es: "A√±ade fragancia: Deja que la cera se enfr√≠e a 60¬∞C, luego a√±ade aceite de lavanda. Mezcla 2 minutos.", fr: "Ajoutez parfum: Laissez la cire refroidir √† 60¬∞C, puis ajoutez l'huile de lavande. M√©langez 2 minutes.", de: "Duft hinzuf√ºgen: Lassen Sie das Wachs auf 60¬∞C abk√ºhlen, dann Lavendel√∂l hinzuf√ºgen. 2 Minuten mischen.", it: "Aggiungi fragranza: Lascia raffreddare la cera a 60¬∞C, poi aggiungi olio di lavanda. Mescola 2 minuti." },
            { en: "Pour: Pour wax in continuous stream into container, keeping wick vertical.", ro: "ToarnƒÉ: VarsƒÉ ceara √Æntr-un jet continuu √Æn recipient, »õin√¢nd fitilul vertical.", es: "Vierte: Vierte la cera en un chorro continuo, manteniendo la mecha vertical.", fr: "Versez: Versez la cire en jet continu en maintenant la m√®che verticale.", de: "Gie√üen: Gie√üen Sie das Wachs in einem kontinuierlichen Strahl und halten Sie den Docht vertikal.", it: "Versa: Versa la cera in un getto continuo mantenendo lo stoppino verticale." },
            { en: "Cool: Let candle cool completely at room temperature for 6-8 hours. Trim wick to 0.5cm.", ro: "RƒÉce»ôte: LasƒÉ lum√¢narea sƒÉ se rƒÉceascƒÉ complet 6-8 ore. Taie fitilul la 0.5cm.", es: "Enfr√≠a: Deja que la vela se enfr√≠e completamente 6-8 horas. Recorta la mecha a 0.5cm.", fr: "Refroidir: Laissez refroidir compl√®tement 6-8 heures. Coupez la m√®che √† 0.5cm.", de: "Abk√ºhlen: Lassen Sie die Kerze 6-8 Stunden vollst√§ndig abk√ºhlen. Docht auf 0,5cm k√ºrzen.", it: "Raffredda: Lascia raffreddare completamente 6-8 ore. Taglia lo stoppino a 0.5cm." }
        ], 
        pm: 60 
    },
    { 
        name: { en: "Vanilla & Cinnamon Candle", ro: "Lum√¢nare Vanilie & Scor»õi»ôoarƒÉ", es: "Vela Vainilla y Canela", fr: "Bougie Vanille Cannelle", de: "Vanille-Zimt-Kerze", it: "Candela Vaniglia Cannella" }, 
        ing: [
            { n: { en: "Paraffin wax", ro: "CearƒÉ de parafinƒÉ", es: "Cera de parafina", fr: "Cire de paraffine", de: "Paraffinwachs", it: "Cera di paraffina" }, q: 250, u: "g" }, 
            { n: { en: "Vanilla essence", ro: "Esen»õƒÉ de vanilie", es: "Esencia de vainilla", fr: "Essence de vanille", de: "Vanille-Essenz", it: "Essenza di vaniglia" }, q: 8, u: "ml" }, 
            { n: { en: "Cinnamon essence", ro: "Esen»õƒÉ de scor»õi»ôoarƒÉ", es: "Esencia de canela", fr: "Essence de cannelle", de: "Zimt-Essenz", it: "Essenza di cannella" }, q: 3, u: "ml" },
            { n: { en: "Cotton wick", ro: "Fitil de bumbac", es: "Mecha de algod√≥n", fr: "M√®che en coton", de: "Baumwolldocht", it: "Stoppino di cotone" }, q: 1, u: "pcs" },
            { n: { en: "Ceramic container", ro: "Recipient ceramicƒÉ", es: "Recipiente cer√°mico", fr: "R√©cipient c√©ramique", de: "Keramikbeh√§lter", it: "Contenitore ceramica" }, q: 1, u: "pcs" }
        ], 
        instr: [
            { en: "Preparation: Fix wick in center of ceramic container. Ensure it's perfectly centered.", ro: "PregƒÉtire: FixeazƒÉ fitilul √Æn centrul recipientului ceramic. AsigurƒÉ-te cƒÉ e perfect centrat.", es: "Preparaci√≥n: Fija la mecha en el centro del recipiente cer√°mico. Aseg√∫rate de que est√© centrada.", fr: "Pr√©paration: Fixez la m√®che au centre du r√©cipient en c√©ramique.", de: "Vorbereitung: Befestigen Sie den Docht in der Mitte des Keramikbeh√§lters.", it: "Preparazione: Fissa lo stoppino al centro del contenitore ceramico." },
            { en: "Melt wax: Heat paraffin wax to 80-85¬∞C. Paraffin requires higher temperature than soy.", ro: "Tope»ôte ceara: √éncƒÉlze»ôte ceara de parafinƒÉ la 80-85¬∞C. Parafina necesitƒÉ temperaturƒÉ mai mare.", es: "Derrite cera: Calienta la cera de parafina a 80-85¬∞C. La parafina requiere mayor temperatura.", fr: "Faire fondre: Chauffez la cire de paraffine √† 80-85¬∞C.", de: "Wachs schmelzen: Erhitzen Sie Paraffinwachs auf 80-85¬∞C.", it: "Sciogli cera: Riscalda la cera di paraffina a 80-85¬∞C." },
            { en: "Mix fragrances: At 75¬∞C, first add vanilla essence, mix well, then add cinnamon.", ro: "AmestecƒÉ parfumurile: La 75¬∞C, adaugƒÉ mai √Ænt√¢i vanilia, amestecƒÉ bine, apoi scor»õi»ôoara.", es: "Mezcla fragancias: A 75¬∞C, a√±ade primero vainilla, mezcla bien, luego canela.", fr: "M√©langez parfums: √Ä 75¬∞C, ajoutez d'abord vanille, m√©langez, puis cannelle.", de: "D√ºfte mischen: Bei 75¬∞C zuerst Vanille, dann Zimt hinzuf√ºgen.", it: "Mescola fragranze: A 75¬∞C, aggiungi prima vaniglia, mescola, poi cannella." },
            { en: "Pour: Pour wax slowly maintaining constant temperature for best results.", ro: "ToarnƒÉ: ToarnƒÉ ceara √Æncet men»õin√¢nd temperatura constantƒÉ pentru rezultate optime.", es: "Vierte: Vierte la cera lentamente manteniendo temperatura constante.", fr: "Versez: Versez lentement en maintenant temp√©rature constante.", de: "Gie√üen: Gie√üen Sie langsam bei konstanter Temperatur.", it: "Versa: Versa lentamente mantenendo temperatura costante." },
            { en: "Decorate: Before wax solidifies, you can add cinnamon sticks or star anise for decoration.", ro: "DecoreazƒÉ: √énainte ca ceara sƒÉ se solidifice, po»õi adƒÉuga be»õi»ôoare de scor»õi»ôoarƒÉ pentru decor.", es: "Decora: Antes de que solidifique, puedes a√±adir palitos de canela para decorar.", fr: "D√©corez: Avant solidification, ajoutez b√¢tons de cannelle pour d√©coration.", de: "Dekorieren: Vor dem Aush√§rten k√∂nnen Sie Zimtstangen hinzuf√ºgen.", it: "Decora: Prima della solidificazione, aggiungi bastoncini di cannella." },
            { en: "Cure: Let candle rest minimum 48 hours before use for full fragrance development.", ro: "Maturare: LasƒÉ lum√¢narea sƒÉ se odihneascƒÉ minim 48 ore pentru dezvoltarea completƒÉ a parfumului.", es: "Curado: Deja reposar m√≠nimo 48 horas para desarrollo completo de fragancia.", fr: "Maturation: Laissez reposer minimum 48 heures pour d√©veloppement complet.", de: "Reifen: Mindestens 48 Stunden ruhen lassen f√ºr volle Duftentwicklung.", it: "Maturazione: Lascia riposare minimo 48 ore per sviluppo completo fragranza." }
        ], 
        pm: 60 
    },
    { 
        name: { en: "Energizing Citrus Candle", ro: "Lum√¢nare Citrice EnergizantƒÉ", es: "Vela C√≠tricos Energizante", fr: "Bougie Agrumes √ânergisante", de: "Energisierende Zitruskerze", it: "Candela Agrumi Energizzante" }, 
        ing: [
            { n: { en: "Soy wax", ro: "CearƒÉ de soia", es: "Cera de soja", fr: "Cire de soja", de: "Sojawachs", it: "Cera di soia" }, q: 200, u: "g" }, 
            { n: { en: "Orange oil", ro: "Ulei de portocalƒÉ", es: "Aceite de naranja", fr: "Huile d'orange", de: "Orangen√∂l", it: "Olio d'arancia" }, q: 5, u: "ml" },
            { n: { en: "Lemon oil", ro: "Ulei de lƒÉm√¢ie", es: "Aceite de lim√≥n", fr: "Huile de citron", de: "Zitronen√∂l", it: "Olio di limone" }, q: 5, u: "ml" },
            { n: { en: "Cotton wick", ro: "Fitil de bumbac", es: "Mecha de algod√≥n", fr: "M√®che en coton", de: "Baumwolldocht", it: "Stoppino di cotone" }, q: 1, u: "pcs" },
            { n: { en: "Yellow dye", ro: "Colorant galben", es: "Colorante amarillo", fr: "Colorant jaune", de: "Gelber Farbstoff", it: "Colorante giallo" }, q: 2, u: "ml" }
        ], 
        instr: [
            { en: "Prepare materials: Measure all ingredients precisely. Prepare container and fix wick.", ro: "PregƒÉte»ôte materialele: MƒÉsoarƒÉ toate ingredientele precis. PregƒÉte»ôte recipientul »ôi fixeazƒÉ fitilul.", es: "Prepara materiales: Mide todos los ingredientes con precisi√≥n. Prepara recipiente y fija mecha.", fr: "Pr√©parez mat√©riaux: Mesurez pr√©cis√©ment. Pr√©parez r√©cipient et fixez m√®che.", de: "Materialien vorbereiten: Messen Sie alle Zutaten genau. Bereiten Sie Beh√§lter vor.", it: "Prepara materiali: Misura tutti gli ingredienti con precisione. Prepara contenitore." },
            { en: "Melt wax: Heat soy wax to 70¬∞C using double boiler for optimal temperature control.", ro: "Tope»ôte ceara: √éncƒÉlze»ôte ceara de soia la 70¬∞C folosind bain-marie pentru control optim.", es: "Derrite cera: Calienta cera de soja a 70¬∞C usando ba√±o mar√≠a para control √≥ptimo.", fr: "Faire fondre: Chauffez cire de soja √† 70¬∞C au bain-marie pour contr√¥le optimal.", de: "Wachs schmelzen: Erhitzen Sie Sojawachs auf 70¬∞C im Wasserbad.", it: "Sciogli cera: Riscalda cera di soia a 70¬∞C a bagnomaria per controllo ottimale." },
            { en: "Add color: Add yellow dye when wax is completely liquid. Mix until uniform yellow-orange shade.", ro: "ColoreazƒÉ: AdaugƒÉ colorantul galben c√¢nd ceara e complet lichidƒÉ. AmestecƒÉ p√¢nƒÉ la nuan»õƒÉ uniformƒÉ.", es: "Colorea: A√±ade colorante amarillo cuando la cera est√© l√≠quida. Mezcla hasta tono uniforme.", fr: "Coloration: Ajoutez colorant jaune quand cire est liquide. M√©langez jusqu'√† teinte uniforme.", de: "F√§rben: F√ºgen Sie gelben Farbstoff hinzu wenn Wachs fl√ºssig ist.", it: "Colora: Aggiungi colorante giallo quando la cera √® liquida. Mescola fino a tonalit√† uniforme." },
            { en: "Add citrus oils: At 60¬∞C, add orange oil first, mix well, then add lemon oil for depth.", ro: "AdaugƒÉ uleiuri citrice: La 60¬∞C, adaugƒÉ uleiul de portocalƒÉ, apoi uleiul de lƒÉm√¢ie.", es: "A√±ade aceites c√≠tricos: A 60¬∞C, a√±ade aceite de naranja primero, luego lim√≥n.", fr: "Ajoutez huiles: √Ä 60¬∞C, ajoutez huile d'orange puis citron pour profondeur.", de: "Zitrus√∂le hinzuf√ºgen: Bei 60¬∞C Orange dann Zitrone f√ºr Tiefe.", it: "Aggiungi oli agrumi: A 60¬∞C, aggiungi olio arancia poi limone per profondit√†." },
            { en: "Pour carefully: Pour in thin steady stream to avoid air bubbles. Keep wick centered.", ro: "ToarnƒÉ cu aten»õie: ToarnƒÉ √Æn jet sub»õire pentru a evita bulele de aer. Men»õine fitilul centrat.", es: "Vierte cuidadosamente: Vierte en chorro fino para evitar burbujas. Mant√©n mecha centrada.", fr: "Versez avec soin: Versez en jet fin pour √©viter bulles. Gardez m√®che centr√©e.", de: "Vorsichtig gie√üen: In d√ºnnem Strahl gie√üen um Blasen zu vermeiden.", it: "Versa con cura: Versa in getto sottile per evitare bolle. Mantieni stoppino centrato." },
            { en: "Finish: After complete cooling, level surface if needed and trim wick to proper length.", ro: "Finalizare: DupƒÉ rƒÉcire completƒÉ, niveleazƒÉ suprafa»õa dacƒÉ e necesar »ôi ajusteazƒÉ fitilul.", es: "Finaliza: Despu√©s de enfriarse, nivela superficie si es necesario y recorta mecha.", fr: "Finition: Apr√®s refroidissement, nivelez surface si n√©cessaire et coupez m√®che.", de: "Fertigstellung: Nach Abk√ºhlung Oberfl√§che nivellieren und Docht trimmen.", it: "Finitura: Dopo raffreddamento, livella superficie se necessario e taglia stoppino." }
        ], 
        pm: 60 
    }
];

function setLang(l) {
    L = l;
    localStorage.setItem('lang', l);
    document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
    event.target.classList.add('active');
    Object.keys(T[l]).forEach(k => {
        const e = document.getElementById(k);
        if (e) e.textContent = T[l][k];
    });
    render();
}

function conv(amt, from, to) {
    if (from === to) return amt;
    return (amt / CR[from]) * CR[to];
}

function fmt(amt) {
    return `${amt.toFixed(2)} ${T[L].curr}`;
}

function showTab(i) {
    document.querySelectorAll('.tab-content').forEach((c, idx) => {
        c.classList.toggle('active', idx === i);
    });
    document.querySelectorAll('.tab-btn').forEach((b, idx) => {
        b.classList.toggle('active', idx === i);
    });
}

function addMat() {
    const n = document.getElementById('matName').value;
    const q = parseFloat(document.getElementById('matQty').value);
    const u = document.getElementById('matUnit').value;
    const p = parseFloat(document.getElementById('matPrice').value);
    const m = parseFloat(document.getElementById('matMin').value);
    if (!n || !q || !p || !m) return alert('Fill all fields!');
    INV.push({ id: Date.now(), n, q, u, p, c: T[L].curr, m });
    localStorage.setItem('inv', JSON.stringify(INV));
    document.getElementById('matName').value = '';
    document.getElementById('matQty').value = '';
    document.getElementById('matPrice').value = '';
    document.getElementById('matMin').value = '';
    render();
}

function delMat(id) {
    if (!confirm('Delete?')) return;
    INV = INV.filter(i => i.id !== id);
    localStorage.setItem('inv', JSON.stringify(INV));
    render();
}

function calcCost(rec, qty = 1) {
    let tot = 0, miss = [], brk = [];
    rec.ing.forEach(ing => {
        const nm = ing.n[L] || ing.n.en;
        const mat = INV.find(m => m.n.toLowerCase().includes(nm.toLowerCase()) || nm.toLowerCase().includes(m.n.toLowerCase()));
        if (mat) {
            let cost = conv(mat.p, mat.c, T[L].curr);
            if (mat.u === 'kg' && ing.u === 'g') cost /= 1000;
            if (mat.u === 'l' && ing.u === 'ml') cost /= 1000;
            cost *= ing.q * qty;
            tot += cost;
            brk.push({ n: nm, q: ing.q * qty, u: ing.u, c: cost });
        } else {
            miss.push({ n: nm, q: ing.q * qty, u: ing.u });
        }
    });
    const prf = tot * (rec.pm / 100);
    return { tot: tot.toFixed(2), sale: (tot + prf).toFixed(2), prf: prf.toFixed(2), miss, brk };
}

function openMod(i) {
    CUR_REC = i;
    const r = RECS[i];
    document.getElementById('modName').textContent = r.name[L] || r.name.en;
    document.getElementById('prodQty').value = 1;
    updMod();
    document.getElementById('modal').classList.add('active');
    document.body.style.overflow = 'hidden';
}

function closeMod() {
    document.getElementById('modal').classList.remove('active');
    document.body.style.overflow = 'auto';
    CUR_REC = null;
}

function chgQty(d) {
    const inp = document.getElementById('prodQty');
    let v = parseInt(inp.value) + d;
    if (v < 1) v = 1;
    inp.value = v;
    updMod();
}

function updMod() {
    if (CUR_REC === null) return;
    const r = RECS[CUR_REC];
    const q = parseInt(document.getElementById('prodQty').value);
    const c = calcCost(r, q);
    
    document.getElementById('modIng').innerHTML = c.brk.map(b => 
        `<div class="ingredient-item"><span>${b.n}</span><span>${b.q} ${b.u}</span><span>${fmt(b.c)}</span></div>`
    ).join('');
    
    if (c.miss.length > 0) {
        document.getElementById('modIng').innerHTML += `
            <div class="missing-badge">
                <strong>‚ö†Ô∏è ${T[L].missingItems}:</strong>
                <ul>${c.miss.map(m => `<li>${m.n}: ${m.q} ${m.u}</li>`).join('')}</ul>
            </div>
        `;
    }
    
    document.getElementById('modInstr').innerHTML = r.instr.map(s => 
        `<li>${s[L] || s.en}</li>`
    ).join('');
    
    document.getElementById('modCost').innerHTML = `
        <div class="cost-row"><span>Cost:</span><span>${fmt(parseFloat(c.tot))}</span></div>
        <div class="cost-row"><span>Profit (${r.pm}%):</span><span>${fmt(parseFloat(c.prf))}</span></div>
        <div class="cost-row total"><span>Price:</span><span>${fmt(parseFloat(c.sale))}</span></div>
    `;
}

function produce() {
    if (CUR_REC === null) return;
    const r = RECS[CUR_REC];
    const q = parseInt(document.getElementById('prodQty').value);
    const c = calcCost(r, q);
    
    if (c.miss.length > 0) return alert('Missing: ' + c.miss.map(m => `${m.n} (${m.q} ${m.u})`).join(', '));
    
    let insuf = [];
    r.ing.forEach(ing => {
        const nm = ing.n[L] || ing.n.en;
        const mat = INV.find(m => m.n.toLowerCase().includes(nm.toLowerCase()));
        if (mat) {
            let need = ing.q * q;
            if (mat.u === 'kg' && ing.u === 'g') need /= 1000;
            if (mat.u === 'l' && ing.u === 'ml') need /= 1000;
            if (mat.q < need) insuf.push(`${mat.n} (need ${need} ${mat.u}, have ${mat.q} ${mat.u})`);
        }
    });
    
    if (insuf.length > 0) return alert('Low stock:\n' + insuf.join('\n'));
    
    if (!confirm(`Produce ${q} x ${r.name[L] || r.name.en}?\nCost: ${fmt(parseFloat(c.tot))}\nPrice: ${fmt(parseFloat(c.sale))}`)) return;
    
    r.ing.forEach(ing => {
        const nm = ing.n[L] || ing.n.en;
        const mat = INV.find(m => m.n.toLowerCase().includes(nm.toLowerCase()));
        if (mat) {
            let need = ing.q * q;
            if (mat.u === 'kg' && ing.u === 'g') need /= 1000;
            if (mat.u === 'l' && ing.u === 'ml') need /= 1000;
            mat.q -= need;
        }
    });
    
    HIST.unshift({ id: Date.now(), n: r.name[L] || r.name.en, q, c: c.tot, s: c.sale, p: c.prf, curr: T[L].curr, d: new Date().toISOString() });
    localStorage.setItem('inv', JSON.stringify(INV));
    localStorage.setItem('hist', JSON.stringify(HIST));
    closeMod();
    alert('‚úÖ Production complete!');
    render();
}

function addEv() {
    const t = document.getElementById('evType').value;
    const ti = document.getElementById('evTitle').value;
    const d = document.getElementById('evDate').value;
    const tm = document.getElementById('evTime').value;
    if (!ti || !d) return alert('Fill title and date!');
    EVS.push({ id: Date.now(), t, ti, d, tm });
    localStorage.setItem('evs', JSON.stringify(EVS));
    document.getElementById('evTitle').value = '';
    document.getElementById('evDate').value = '';
    document.getElementById('evTime').value = '';
    render();
}

function delEv(id) {
    if (!confirm('Delete?')) return;
    EVS = EVS.filter(e => e.id !== id);
    localStorage.setItem('evs', JSON.stringify(EVS));
    render();
}

function exportCal() {
    if (EVS.length === 0) return alert('No events!');
    let ics = 'BEGIN:VCALENDAR\nVERSION:2.0\nPRODID:-//Candle Workshop//EN\n';
    EVS.forEach(e => {
        const dt = e.tm ? `${e.d.replace(/-/g, '')}T${e.tm.replace(':', '')}00` : e.d.replace(/-/g, '');
        ics += `BEGIN:VEVENT\nUID:${e.id}\nDTSTART:${dt}\nSUMMARY:${e.ti}\nEND:VEVENT\n`;
    });
    ics += 'END:VCALENDAR';
    const blob = new Blob([ics], { type: 'text/calendar' });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'candle-calendar.ics';
    a.click();
}

function render() {
    document.getElementById('stat1').textContent = INV.length;
    const low = INV.filter(i => i.q <= i.m);
    document.getElementById('stat2').textContent = low.length;
    document.getElementById('stat3').textContent = HIST.reduce((s, h) => s + h.q, 0);
    document.getElementById('stat4').textContent = EVS.length;
    
    document.getElementById('alerts').innerHTML = low.length === 0 ? 
        '<div class="alert alert-success">‚úì All OK!</div>' :
        low.map(i => `<div class="alert ${i.q === 0 ? 'alert-danger' : 'alert-warning'}">‚ö†Ô∏è ${i.n}: ${i.q} ${i.u}</div>`).join('');
    
    document.getElementById('matList').innerHTML = INV.length === 0 ?
        '<p style="text-align:center;color:#666">No materials</p>' :
        INV.map(i => {
            const cls = i.q === 0 ? 'out-of-stock' : i.q <= i.m ? 'low-stock' : '';
            const p = conv(i.p, i.c, T[L].curr);
            return `<div class="item ${cls}">
                <div class="item-info">
                    <h3>${i.n}</h3>
                    <p>${i.q} ${i.u} | ${fmt(p)}/${i.u} | Min: ${i.m}</p>
                </div>
                <div class="item-actions">
                    <button class="btn btn-danger btn-small" onclick="delMat(${i.id})">üóëÔ∏è</button>
                </div>
            </div>`;
        }).join('');
    
    document.getElementById('recList').innerHTML = RECS.map((r, i) => {
        const c = calcCost(r);
        const allIng = r.ing.map(ing => `${ing.q} ${ing.u} ${ing.n[L] || ing.n.en}`).join(', ');
        
        return `<div class="recipe-preview" onclick="openMod(${i})">
            <h3>üïØÔ∏è ${r.name[L] || r.name.en}</h3>
            <div class="ingredients-needed">
                <h4>${T[L].needsTitle}:</h4>
                <ul>${r.ing.map(ing => `<li>${ing.q} ${ing.u} ${ing.n[L] || ing.n.en}</li>`).join('')}</ul>
            </div>
            ${c.miss.length > 0 ? 
                `<div class="missing-badge">
                    <strong>‚ö†Ô∏è ${T[L].missingItems}:</strong>
                    <ul>${c.miss.map(m => `<li>${m.n}: ${m.q} ${m.u}</li>`).join('')}</ul>
                </div>` : 
                '<div style="background:#D1FAE5;padding:0.5rem;border-radius:8px;margin:1rem 0">‚úì Ready to produce</div>'
            }
            <div class="cost-badge">üí∞ ${fmt(parseFloat(c.sale))}</div>
            <p style="font-size:0.85rem;color:#666">Click for details</p>
        </div>`;
    }).join('');
    
    document.getElementById('histList').innerHTML = HIST.length === 0 ?
        '<p style="text-align:center;color:#666">No production</p>' :
        HIST.map(h => {
            const p = conv(parseFloat(h.p), h.curr, T[L].curr);
            return `<div class="item">
                <div class="item-info">
                    <h3>${h.n}</h3>
                    <p>${h.q} pcs | Profit: ${fmt(p)} | ${new Date(h.d).toLocaleDateString()}</p>
                </div>
            </div>`;
        }).join('');
    
    document.getElementById('evList').innerHTML = EVS.length === 0 ?
        '<p style="text-align:center;color:#666">No events</p>' :
        EVS.map(e => `<div class="item">
            <div class="item-info">
                <h3>${e.t === 'prod' ? 'üè≠' : 'üí∞'} ${e.ti}</h3>
                <p>${new Date(e.d).toLocaleDateString()} ${e.tm || ''}</p>
            </div>
            <div class="item-actions">
                <button class="btn btn-danger btn-small" onclick="delEv(${e.id})">üóëÔ∏è</button>
            </div>
        </div>`).join('');
}

document.getElementById('modal').onclick = e => { if (e.target.id === 'modal') closeMod(); };
setLang(L);
render();
    </script>
</body>
